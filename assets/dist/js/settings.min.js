/*! Clef for WordPress - v2.0
 * http://getclef.com
 * Licensed GPLv2+ */
(function(e){var t,i,n,r,s,o;return Backbone.emulateHTTP=!0,t=Backbone.View.extend({id:"clef-settings-container",initialize:function(e){return this.opts=e,this.settings=new r(_.extend(this.opts,{options_name:"wpclef"})),this.settings.render(),window.onbeforeunload=function(e){return function(){return e.settings.isSaving()?"Some settings are still being saved. Are you sure you want to navigate away?":void 0}}(this)}}),o=Backbone.View.extend({el:e("#clef-tutorial"),events:{"click .next":"next","click .previous":"previous"},initialize:function(t){var i,n,r,o;for(this.opts=t,this.subs=[],o=this.$el.find(".sub"),n=0,r=o.length;r>n;n++)i=o[n],this.subs.push(new s({el:i}));return this.currentSub=this.subs[0],e(window).on("message",this.handleLogin.bind(this))},render:function(){return this.currentSub.render(),this.loadIFrame(),this.$el.fadeIn()},next:function(){var e;return e=this.subs[_.indexOf(this.subs,this.currentSub)+1],e?(e.isLogin()&&this.loggedIn&&(e=this.subs[_.indexOf(this.subs,this.newSub)+1]),this.currentSub.hide(),e.render(),this.currentSub=e):void 0},previous:function(){var e;return e=this.subs[_.indexOf(this.subs,this.currentSub)-1],e?(this.currentSub.hide(),e.render(),this.currentSub=e):void 0},loadIFrame:function(){var e;return e=this.$el.find("iframe"),e.attr("src",e.data("src"))},handleLogin:function(){return this.loggedIn=!0,this.currentSub.isLogin()?this.next():void 0}}),s=Backbone.View.extend({initialize:function(t){return this.opts=t,this.setElement(e(this.opts.el))},render:function(){return this.$el.show()},hide:function(){return this.$el.hide()},remove:function(){return this.$el.remove()},isLogin:function(){return this.$el.find("iframe").length}}),r=AjaxSettingsView.extend({initialize:function(e){return this.modelClass=n,r.__super__.initialize.call(this,e),this.formView=new i({model:this.model}),this.xmlEl=this.model.cfindInput("clef_password_settings_xml_allowed").parents(".input-container"),this.overrideContainer=this.$el.find(".override-settings"),this.overrideButtonContainer=this.$el.find(".override-buttons"),this.setOverrideLink(),this.badgePreviewContainer=this.$el.find(".support-settings .footer-preview")},updated:function(e,t){return r.__super__.updated.call(this,e,t),this.setOverrideLink()},render:function(){var e;return r.__super__.render.call(this),e=this.model.passwordsDisabled(),this.xmlEl.toggle(e),this.overrideContainer.toggle(e),this.overrideButtonContainer.toggle(this.model.overrideIsSet()),this.renderSupportBadge(),this.$el.is(":not(:visible)")?this.$el.fadeIn():void 0},toggleInputs:function(e){return this.formView.toggleForm(!!parseInt(e.currentTarget.value))},setOverrideLink:function(){var e,t;return(t=this.model.overrideKey())?(this.overrideBase||(this.overrideBase=this.overrideContainer.find("label").text()),e=this.overrideButtonContainer.find("a"),e.on("click",function(e){return e.preventDefault()}),e.attr("href",this.overrideBase+t)):void 0},isSaving:function(){return this.model.saving},renderSupportBadge:function(){var e;return e=this.model.badgeSetting(),this.badgePreviewContainer.toggle("disabled"!==e),this.badgePreviewContainer.find("a").toggleClass("pretty","badge"===e)}}),n=AjaxSettingsModel.extend({cget:function(e){return this.get("wpclef["+e+"]")},cfindInput:function(e){return e="wpclef["+e+"]",n.__super__.findInput.call(this,e)},passwordsDisabled:function(){return!!parseInt(this.cget("clef_password_settings_disable_passwords"))||"Disabled"!==this.cget("clef_password_settings_disable_certain_passwords")||this.passwordsFullyDisabled()},passwordsFullyDisabled:function(){return!!parseInt(this.cget("clef_password_settings_force"))},overrideIsSet:function(){return!!this.overrideKey()},overrideKey:function(){return this.cget("clef_override_settings_key")},badgeSetting:function(){return this.cget("support_clef_badge").toLowerCase()}}),i=Backbone.View.extend({el:e("#login-form-view"),template:_.template(e("#form-template").html()),initialize:function(e){return this.opts=e,this.model=this.opts.model,this.listenTo(this.model,"change",this.toggleForm),this.render()},render:function(){return this.$el.html(this.template),this.$el.find('input[type="submit"]').on("click",function(e){return e.preventDefault()}),this.toggleForm()},toggleForm:function(){return this.$el.toggleClass("only-clef",this.model.passwordsFullyDisabled())}}),this.AppView=t,e(document).ready(function(){var e;return e=new t(options)}),e.fn.serializeObject=function(){var t,i,n,r,s;for(i={},s=e(this).serializeArray(),n=0,r=s.length;r>n;n++)t=s[n],i[t.name]=t.value;return i}}).call(this,jQuery);