(function(e,i){var t;return t=i.Model.extend({url:ajaxurl+"?action=ajax_settings_save",parse:function(e,i){return i.form?(this.optionsName=i.options_name,this.url=ajaxurl+("?action=ajax_settings_save_"+this.optionsName),i.url&&(this.url=i.url),i.network_wide&&(this.url+="&network_wide=true"),this.$form=i.form,_.extend(e,this.$form.serializeObject())):void 0},isNew:function(){return!1},update:function(i){var t;return t=e(i),t.is(":checkbox")&&(i.value=t.is(":checked")?1:0),this.saving=!0,this.save(i.name,i.value,{success:this.saveSuccess.bind(this),error:this.saveError.bind(this)})},saveSuccess:function(){return this.saving=!1},saveError:function(){return this.saving=!1},findInput:function(e,i){return null==i&&(i={}),this._is||(this._is={}),this._is[e]||(this._is[e]=this.$form.find("input, select").filter("[name='"+e+"']")),this._is[e]}}),e.fn.serializeObject=function(){var i,t,s,n,r;for(t={},r=e(this).serializeArray(),s=0,n=r.length;n>s;s++)i=r[s],t[i.name]=i.value;return t},t.extend=i.Model.extend,this.AjaxSettingsModel=t}).call(this,jQuery,Backbone);
(function(e,s){var t;return s.emulateHTTP=!0,t=s.View.extend({messageTemplate:_.template("<div class='<%=type%> ajax-settings-msg'><p><%= message %></p></div>"),events:{"change input:not(.ajax-ignore)":"persistChanges","change select:not(.ajax-ignore)":"persistChanges"},modelClass:AjaxSettingsModel,el:'form[action="options.php"]',successEls:{},errorEls:{},genericErrorMessage:"Something went wrong, please refresh and try again.",successMessageDisplayTime:3e3,initialize:function(s){return this.opts=s,this.opts.formSelector&&this.setElement(e(s.formSelector)),this.hide(),this.model=new this.modelClass({},_.extend({form:this.$el,parse:!0},this.opts)),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.startUpdating),this.listenTo(this.model,"sync",this.updated),this.listenTo(this.model,"error",this.error),this.listenTo(this.model,"change",this.clearErrors)},hide:function(){return this.$el.hide()},render:function(){var e,s,t,r,i;r=this.model.attributes,i=[];for(s in r)t=r[s],e=this.model.findInput(s),i.push(e?e.val(t):void 0);return i},show:function(){return this.$el.fadeIn()},persistChanges:function(e){return e.preventDefault(),this.model.update(e.currentTarget)},startUpdating:function(e){var s,t,r,i;r=e.changed,i=[];for(s in r)t=r[s],i.push(this.settingUpdateSent(this.model.findInput(s)));return i},updated:function(e){var s,t,r,i;this.render(),r=e.changed,i=[];for(s in r)t=r[s],i.push(this.settingUpdateSuccess(this.model.findInput(s)));return i},error:function(e,s){var t,r,i,n;if(!s.responseJSON||!s.responseJSON.data)return void this.showMessage({message:this.genericErrorMessage,type:"error"});if(!s.responseJSON.data.errors&&s.responseJSON.data.error)return void this.showMessage({message:s.responseJSON.data.error,type:"error"});i=s.responseJSON.data.errors,n=[];for(t in i)r=i[t],n.push(this.settingsUpdateError(this.model.findInput(""+this.opts.options_name+"["+t+"]"),r));return n},clearErrors:function(e){var s,t,r,i,n;this.globalError&&(this.globalError.remove(),this.globalError=null),i=e.changed,n=[];for(t in i)r=i[t],s=this.model.findInput(t),this.errorEls[s]?(this.errorEls[s].remove(),n.push(this.errorEls[s]=null)):n.push(void 0);return n},settingUpdateSent:function(){},settingUpdateSuccess:function(s){var t;if(s.length&&!this.successEls[s])return t=e(this.messageTemplate({message:"Setting saved.",type:"updated"})).hide(),this.successEls[s]=t.insertAfter(s).slideDown(),setTimeout(function(e){return function(){return t.slideUp(),delete e.successEls[s]}}(this),this.successMessageDisplayTime)},settingsUpdateError:function(s,t){var r;return this.errorEls[s]?this.errorEls[s].find("p").html(t):(r=e(this.messageTemplate({message:t,type:"error"})).hide(),this.errorEls[s]=r.insertAfter(s).slideDown())},showMessage:function(s){var t;return t=e(this.messageTemplate(s)).hide(),this.globalError=t.prependTo(this.$el).slideDown(),e("html, body").animate({scrollTop:this.$el.scrollTop()},"slow")}},{extend:s.View.extend}),this.AjaxSettingsView=t,e(document).ready(function(){var e;return ajaxSetOpt.initialize?(e=""+ajaxSetOpt.options_name+"AjaxSettingsView",window[e]=new t(ajaxSetOpt)):void 0}),e.fn.leftPositionWithPadding=function(){var e;return e=this.position().left,e+=this.width(),this.css("padding-left")&&(e+=parseInt(this.css("padding-left"))),this.css("padding-right")&&(e+=parseInt(this.css("padding-right"))),this.css("border-left")&&(e+=parseInt(this.css("border-left"))),this.css("border-right")&&(e+=parseInt(this.css("border-right"))),e}}).call(this,jQuery,Backbone);